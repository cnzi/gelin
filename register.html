<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>__(common.nav7)__</title>
    <link rel="shortcut icon" href="favicon.ico">

    <!-- build:css -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/register.css">
    <!-- endbuild -->
</head>

<body>
    <partial src="nav.html"></partial>

    <div class="pageNav">
        <div class="container-fulid pageNav-bg">
            <div class="title-text">
                <h1>
                    <span style='color:#ffc105;'>__(register.title1)__</span>__(register.title2)__</h1>
            </div>
        </div>
    </div>
    <div class="container main">
        <h1>__(register.title)__</h1>
        <div class="topbar row">
            <div class="step step1 col-6">1. __(register.step1)__</div>
            <div class="step col-6">2. __(register.step2)__</div>
        </div>
    </div>
    <div class="register-form">
        <form id="register" class="needs-validation container" action="">
            <div class="block account row">
                <div class="col-12 col-sm-12 col-lg-6 offset-lg-3">
                    <div class="form-title">__(register.idInfo)__</div>
                    <div class="form-group row">
                        <label for="account-name" class="col-12 col-sm-2">__(register.id)__</label>
                        <input type="text" class="form-control col-12 col-sm-10" name="account" required placeholder="输入账号名称">
                    </div>
                    <div class="form-group row">
                        <label for="phone-number" class="col-12 col-sm-2">__(register.phone)__</label>
                        <select name="area_code" id="phone-code" class="form-control col-3 col-sm-2" style="margin-top: 5px;">
                        </select>
                        <input name="mobile" type="phone" class="form-control col-9 col-sm-8" required placeholder="输入手机号">
                    </div>
                    <div class="form-group row">
                        <label for="phone-number" class="col-12 col-sm-2">__(register.verificationCode)__</label>
                        <input type="text" class="form-control col-8 col-sm-7" name="mcode" placeholder="输入验证码">
                        <button class="btn btn-primary col-4 col-sm-3">__(register.getCode)__</button>
                    </div>
                    <div class="form-group row">
                        <label for="phone-number" class="col-12 col-sm-2">__(register.password)__</label>
                        <input type="password" class="form-control col-12 col-sm-10" name="password" placeholder="输入密码">
                    </div>
                    <div class="form-group row">
                        <label for="phone-number" class="col-12 col-sm-2">__(register.passwordAgain)__</label>
                        <input type="password" class="form-control col-12 col-sm-10" name="password2" placeholder="输入密码">
                    </div>
                </div>
            </div>
            <div class="block register row">
                <div class="col-12 col-sm-10 col-lg-6 offset-sm-1 offset-lg-3">
                    <div class="form-title">__(register.regInfo)__</div>
                    <div class="form-group row">
                        <label class="col-4 col-sm-2">__(register.name)__</label>
                        <input name="real_name" type="text" class="form-control col-8 col-sm-10" aria-describedby="emailHelp" placeholder="输入姓名">
                    </div>
                    <div class="form-group row">
                        <label for="gender" class="col-4 col-sm-2">__(register.sex)__</label>
                        <select name="sex" class="form-control col-8 col-sm-10">
                            <option selected>__(register.male)__</option>
                            <option>__(register.female)__</option>
                        </select>
                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-sm-2">__(register.address)__</label>
                        <select id="country-list" name="province_id" class="form-control col-4 col-sm-5">
                        </select>
                        <select id="city-list" name="city_id" class="form-control col-4 col-sm-5">
                        </select>
                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-sm-2">__(register.yearLevel)__</label>
                        <select name="group" class="form-control col-8 col-sm-10">
                            <option value="1" selected>1-2年级</option>
                            <option value="2">3-4年级</option>
                            <option value="3">5-6年级</option>
                        </select>
                    </div>
                    <div class="form-group row">
                        <label for="school" class="col-4 col-sm-2">学校码</label>
                        <input name="school_code" type="text" class="form-control col-8 col-sm-10" id="school" placeholder="输人学校码">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="terms" value="" required>
                    <label class="read form-check-label" for="terms">你已经阅读并接受
                        <span class="terms">《大赛协议》</span>
                    </label>
                </div>
            </div>
            <button id="submit" type="submit" class="btn btn-primary col-4">__(register.complete)__</button>
        </form>
    </div>
    <footer class="pagefooter">
        <p>__(common.footer)__</p>
    </footer>
    <script src="/assets/js/main.js "></script>
    <script src="/assets/js/jquery.tmpl.js "></script>
    <script id="codeTpl" type="text/x-jquery-tmpl">
        {{each(i, item) list}}
        <option value=${item.code}>${item.name}</option>
        {{/each}}
    </script>
    <script id="countryTpl" type="text/x-jquery-tmpl">
        {{each(i, item) list}}
        <option value=${item.id}>${item.name}</option>
        {{/each}}
    </script>
    <script>
        function skipInput(e) {
            var inputs = $(".form-control"); //获取登录页面的input标签
            if (e.keyCode == 13) {
                for (var i = 0; i < inputs.length; i++) {
                    //循环input标签的数量
                    if (i == (inputs.length - 1)) {
                        // 到最后一个标签
                        break;
                    } else if (e.target == inputs[i]) {
                        inputs[i + 1].focus();
                        break;
                    }
                }
            }
        }

        function loadList() {
            $.ajax({
                dataType: "json",
                url: "http://60.205.107.191:9911/area/getPhoneAreaCode_json",
                success: function(r) {
                    $("#codeTpl").tmpl({
                        list: r.data.list,
                    }).appendTo("#phone-code");
                }
            });
        }
        function loadCountry(id, target) {
            $.ajax({
                dataType: "json",
                url: "http://60.205.107.191:9911/area/getSubList_json?id="+id,
                success: function(r) {
                    $("#countryTpl").tmpl({
                        list: r.data.list,
                    }).appendTo( target || "#country-list");
                }
            });
        }
        $('#submit').click(function(e) {
            var query = $('#register').serialize();
            var data = {};
            var qs = query.split('&');
            for (var i = 0; i < qs.length; i++) {
                var item = qs[i].split('=');
                if (!item[1]) {
                    return;
                }
                data[item[0]] = item[1];
            }
            $.ajax({
                type: "POST", //方法类型
                dataType: "json", //预期服务器返回的数据类型
                url: "http://60.205.107.191:9911/client/regitster/join_json", //url
                data: query,
                success: function(result) {
                    console.log(result);
                    if (result.resultCode == 200) {
                        alert("报名成功");
                        location.href = '/portal/game/download';
                    }
                },
                error: function() {
                    alert("报名异常");
                }
            });

        });
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function() {
            'use strict';
            $('.form-control').keypress(skipInput);
            window.addEventListener('load', function() {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
                loadList();
                loadCountry(0, '#country-list');
                $('#country-list').on('change', function(e) {
                    loadCountry(e.target.value, '#city-list');
                });
            }, false);
        })();
    </script>
</body>

</html>